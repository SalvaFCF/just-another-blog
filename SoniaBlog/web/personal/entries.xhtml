<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core">
  
  <body>
    
    <ui:composition template="/personal/template.xhtml">
      
      <ui:define name="title">
        <h:outputText value="#{label.entries}" />
      </ui:define>
      
      <ui:define name="head">
        <script type="text/javascript" src="${facesContext.externalContext.requestContextPath}/resources/tiny_mce/tiny_mce.js"></script>
        <script type="text/javascript">
          tinyMCE.init({
            theme : "advanced",
            mode : "textareas",
            plugins : "fullscreen,safari,emotions,imgbrowser",
            theme_advanced_buttons3_add : "|,emotions,fullscreen,imgbrowser", 
            <h:outputText value="content_css: '/jab#{BlogBean.template.contentCSS}?' + new Date().getTime()," 
                          rendered="#{BlogBean.template.contentCSS != null}" />
            convert_urls : false,
            fullscreen_new_window : true,
            fullscreen_settings : {
              theme_advanced_path_location : "top"
            }
          });

        </script>
      </ui:define>
      
      <ui:define name="info">
        
        <h:form>
          
          <h:commandLink value="#{label.newEntry}" action="#{EntryBean.newEntry}" />
          
          <h3><h:outputText value="#{label.entries}" /></h3>
          
          <ul>
            <ui:repeat value="#{EntryBean.entries}" var="Entry">
              <li><h:commandLink value="#{Entry.title}" action="#{EntryBean.edit}" /></li>
            </ui:repeat>
          </ul>
        </h:form>
        
      </ui:define>
      
      <ui:define name="content">
      
        <h1><h:outputText value="#{label.entries}" /></h1>
        
        <h:form enctype="multipart/form-data">
          
          <h:panelGrid columns="2" styleClass="editor" columnClasses="e1,e2">
            
            <h:outputLabel for="title" value="#{label.title}" />
            <h:panelGroup>
              <h:inputText styleClass="full" id="title" value="#{EntryBean.entry.title}" required="true" />
              <h:message for="title" />
            </h:panelGroup>
            
            <h:outputLabel for="tags" value="#{label.tags}" />
            <h:panelGroup>
              <h:inputText id="tags" styleClass="full" value="#{EntryBean.tagString}" />
              <h:message for="tags" />
            </h:panelGroup>
            
            <h:outputLabel for="category" value="#{label.category}" />
            <h:panelGroup>
              <h:selectOneMenu id="category" value="#{EntryBean.entry.category}" converter="converter.category">
                <f:selectItems value="#{EntryBean.categoryItems}" />
              </h:selectOneMenu>
              <h:message for="category" />
            </h:panelGroup>
            
            <h:outputLabel for="content" value="#{label.content}" />
            <h:panelGroup>
              <h:inputTextarea id="content" style="width: 100%; height: 300px;" value="#{EntryBean.entry.content}" required="true" />
              <h:message for="content" />
            </h:panelGroup>
            
            <h:outputLabel for="teaser" value="#{label.teaser}" />
            <h:panelGroup>
              <h:inputTextarea id="teaser" style="width: 100%; height: 150px;" value="#{EntryBean.entry.teaser}">
                <f:validateLength maximum="5000" />
              </h:inputTextarea>
              <h:message for="teaser" />
            </h:panelGroup>
            
            <h:outputLabel value="#{label.attachments}" />
            <h:panelGroup layout="block" styleClass="attachments">
              <h:dataTable styleClass="full" value="#{EntryBean.attachments}" var="Attachment">
                <h:column>
                  <f:facet name="header">
                    <h:outputText value="#{label.name}" />
                  </f:facet>
                  <h:outputLink value="../../../attachment/#{Attachment.id}" target="_blank">
                    <h:outputText value="#{Attachment.name}" />
                  </h:outputLink>
                </h:column>
                <h:column>
                  <f:facet name="header">
                    <h:outputText value="#{label.mimeType}" />
                  </f:facet>
                  <h:outputText value="#{Attachment.mimeType}" />
                </h:column>
                <h:column>
                  <f:facet name="header">
                    <h:outputText value="#{label.size}" />
                  </f:facet>
                  <h:outputText value="#{Attachment.size}" />
                </h:column>
                <h:column>
                  <f:facet name="header">
                    <h:outputText value="#{label.creationDate}" />
                  </f:facet>
                  <h:outputText value="#{Attachment.creationDate}">
                    <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" />
                  </h:outputText>
                </h:column>
                <h:column>
                  <h:commandLink value="#{label.remove}" actionListener="#{EntryBean.removeAttachment}" />
                </h:column>
              </h:dataTable>
              <t:inputFileUpload value="#{EntryBean.uploadedFile}" /><br />
              <h:selectBooleanCheckbox id="unzip" value="#{EntryBean.unzipFiles}" />
              <h:outputLabel for="unzip" value="#{label.unzipFiles}" /><br />
              <h:commandButton value="#{label.upload}" action="#{EntryBean.upload}" />
            </h:panelGroup>
            
          </h:panelGrid>
          
          <h:commandButton value="#{label.publish}" action="#{EntryBean.publish}" />
          <h:commandButton value="#{label.saveDraft}" action="#{EntryBean.saveDraft}" />
          <h:commandButton value="#{label.remove}" action="#{EntryBean.remove}" />
          
        </h:form>
        
      </ui:define>
      
    </ui:composition>
    
  </body>
</html>
