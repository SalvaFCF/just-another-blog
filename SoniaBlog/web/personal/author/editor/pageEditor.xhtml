<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:blog="http://jab.nitilon.org/blog/"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:c="http://java.sun.com/jstl/core">

  <body>

    <ui:composition template="../../template.xhtml">

      <ui:define name="title">
        <h:outputText value="#{label.pages}" />
      </ui:define>

      <ui:define name="head">
        <script type="text/javascript" src="${facesContext.externalContext.requestContextPath}/resources/tiny_mce/tiny_mce.js"></script>
        <script type="text/javascript">
          tinyMCE.init({
            theme : "advanced",
            mode : "textareas",
            skin : "jab",
            plugins : "fullscreen,safari,emotions,imgbrowser,attachment,links,table,macro,imgresize",
            theme_advanced_buttons3_add : "|,table,emotions,fullscreen,|,imgbrowser,attachment,links,macro",
            theme_advanced_toolbar_location : "top",
            theme_advanced_toolbar_align : "left",
            <h:outputText value="content_css: '#{EntryBean.contentCSS}?' + new Date().getTime(),"
                          rendered="#{BlogBean.template.contentCSS != null}" />
            convert_urls : false,
            <h:outputText value="document_base_url : '#{EntryBean.baseUrl}'," />

            <h:outputText value="imageHandlerPattern : '#{EntryBean.imageHandlerUri}'," />
              
            fullscreen_new_window : true,
            fullscreen_settings : {
              theme_advanced_path_location : "top"
            }
          });
          function popup()
          {
            window.open(
              '${facesContext.externalContext.requestContextPath}/personal/author/editor/pages.jab?id=pageForm:navigationParent&amp;description=navigationParentLabel',
              'pages',
              'width=300,height=400,status=yes,scrollbars=yes,resizable=yes'
            );
          }
        </script>
      </ui:define>

      <ui:define name="content">

        <c:set scope="session" var="blogEditor" value="page" />

        <h1><h:outputText value="#{label.pages}" /></h1>

        <h:form id="pageForm" enctype="multipart/form-data">

          <h:panelGrid columns="2" styleClass="editor" columnClasses="e1,e2">

            <h:outputLabel for="title" value="#{label.title}" />
            <h:panelGroup>
              <h:inputText styleClass="full" id="title" value="#{PageAuthorBean.page.title}" required="true" />
              <h:message for="title" />
            </h:panelGroup>

            <h:outputLabel for="content" value="#{label.content}" />
            <h:panelGroup>
              <h:inputTextarea id="content" style="width: 100%; height: 400px;" value="#{PageAuthorBean.page.content}" required="true" />
              <h:message for="content" />
            </h:panelGroup>

          </h:panelGrid>

          <h2><h:outputText value="#{label.navigation}" /></h2>

          <h:panelGrid columns="3" styleClass="editor" columnClasses="e1,e2,none">

            <h:outputLabel for="navigationTitle" value="#{label.title}" />
            <h:inputText id="navigationTitle" value="#{PageAuthorBean.page.navigationTitle}" required="true" />
            <h:message for="navigationTitle" />

            <h:outputLabel for="navigationParent" value="#{label.parentPage}" />
            <h:panelGroup>
              <span id="navigationParentLabel">
                <h:outputText value="#{PageAuthorBean.page.parent.navigationTitle}"
                              rendered="#{PageAuthorBean.page.parent != null}" />
              </span>
              <h:inputHidden id="navigationParent" value="#{PageAuthorBean.parentId}" />
              <a href="#" onclick="popup()">
                <h:outputText value="#{label.choose}" />
              </a>
            </h:panelGroup>
            <h:message for="navigationParent" />

            <h:outputLabel for="navigationPos" value="#{label.position}" />
            <h:inputText id="navigationPos" value="#{PageAuthorBean.page.navigationPosition}" required="true">
              <f:validateLongRange minimum="0" />
            </h:inputText>
            <h:message for="navigationPos" />

          </h:panelGrid>

          <h:commandButton value="#{label.publish}" action="#{PageAuthorBean.publish}" />
          <h:commandButton value="#{label.saveDraft}" action="#{PageAuthorBean.saveDraft}" />
          <t:commandButton target="_blank" value="#{label.preview}" actionListener="#{PageAuthorBean.preview}" />
          <h:commandButton value="#{label.remove}" action="#{PageAuthorBean.remove}" rendered="#{!PageAuthorBean.new}" />

        </h:form>

      </ui:define>

    </ui:composition>

  </body>
</html>
